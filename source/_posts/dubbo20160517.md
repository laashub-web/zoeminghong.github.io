---
title: Dubbo+SpringMVC工程创建详解（附工程文件）
tags: code
date: 2016-05-17
---
Dubbo出现的目的是为了应对现在高并发，高数据量请求的问题。目前的垂直应用架构已经无法满足现在大数据的冲击，SOA就应运而生，而Dubbo在国内使用的还是比较多，稳定性也比较不错。

<!-- more -->
### 架构

![架构](http://dubbo.io/dubbo-architecture.jpg-version=1&modificationDate=1330892870000.jpg)

#### 节点角色说明：

> Provider: 暴露服务的服务提供方。
> Consumer: 调用远程服务的服务消费方。
> Registry: 服务注册与发现的注册中心。
> Monitor: 统计服务的调用次调和调用时间的监控中心。
> Container: 服务运行容器。

#### 调用关系说明：

> 1. 服务容器负责启动，加载，运行服务提供者。
> 2. 服务提供者在启动时，向注册中心注册自己提供的服务。
> 3. 服务消费者在启动时，向注册中心订阅自己所需的服务。
> 4. 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。
> 5. 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。
> 6. 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。
>

**(1) 连通性：**

注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小

监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示

服务提供者向注册中心注册其提供的服务，并汇报调用时间到监控中心，此时间不包含网络开销

服务消费者向注册中心获取服务提供者地址列表，并根据负载算法直接调用提供者，同时汇报调用时间到监控中心，此时间包含网络开销

注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外

注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者

注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表

注册中心和监控中心都是可选的，服务消费者可以直连服务提供者

**(2) 健状性：**

监控中心宕掉不影响使用，只是丢失部分采样数据

数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务

注册中心对等集群，任意一台宕掉后，将自动切换到另一台

注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯

服务提供者无状态，任意一台宕掉后，不影响使用

服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复

**(3) 伸缩性：**

注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心

服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者

**(4) 升级性：**

当服务集群规模进一步扩大，带动IT治理结构进一步升级，需要实现动态部署，进行流动计算，现有分布式服务架构不会带来阻力：

> 可以得出，注册中心若宕机，只要没有注册新的服务，服务提供者和消费者还是可以根据本地缓存进行沟通。
> 并且注册中心不是请求转发中心，所以压力是比较小的。

### 搭建Dubbo工程

**1、ZooKeeper的配置安装**

[http://blog.csdn.net/u013142781/article/details/50395650](http://blog.csdn.net/u013142781/article/details/50395650)

**2、Dubbo-admin配置安装**

[http://blog.csdn.net/u013142781/article/details/50396621](http://blog.csdn.net/u013142781/article/details/50396621)

**3、工程API工程创建**

![API](http://7xp64w.com1.z0.glb.clouddn.com/mx378F9.png)

`工程使用Maven+SpringMVC的方式构建`

`ITestService.java`

```java
package com.gege.service;

public interface ITestService {
	public String getName();
}

```

`DubboInit.java`

```java
package com.gege.tool;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;

import org.apache.commons.lang.exception.ExceptionUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class DubboInit extends HttpServlet {

	/**
	 * 
	 */
	private static final long serialVersionUID = 8279515033200832L;
	private Logger logger = (Logger) LoggerFactory.getLogger(DubboInit.class);
	/**
	 * 启动dubbo容器
	 */
	public void init() throws ServletException {
		try {
			startApplicationContext();
		} catch (Exception e) {
			e.printStackTrace();
			logger.error(ExceptionUtils.getFullStackTrace(e));
		}
	}

	public static ApplicationContext applicationContext = null;

	/**
	 * 启动spring容器
	 * @return
	 */
	public static ApplicationContext startApplicationContext() {
		if (applicationContext == null) {
			applicationContext = new ClassPathXmlApplicationContext("classpath*:applicationContext.xml");
		}
		return applicationContext;
	};

}

```

`pom.xml`

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.gege</groupId>
	<artifactId>api</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<spring.version>3.2.8.RELEASE</spring.version>
	</properties>

	<dependencies>
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>3.8.1</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>servlet-api</artifactId>
			<version>2.5</version>
			<scope>provided</scope>
		</dependency>
		<!-- spring相关 -->
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-core</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-beans</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-jdbc</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-web</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-webmvc</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-aop</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-tx</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-orm</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context-support</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-test</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-jms</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-log4j12</artifactId>
			<version>1.7.2</version>
		</dependency>
		<dependency>
			<groupId>commons-lang</groupId>
			<artifactId>commons-lang</artifactId>
			<version>2.5</version>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<source>1.7</source>
					<target>1.7</target>
					<encoding>utf8</encoding>
					<fileNameMapping>no-version</fileNameMapping>
				</configuration>
			</plugin>
		</plugins>
	</build>
</project>
```

**4、Dubbo服务提供者工程创建与配置**

![服务提供者工程](http://7xp64w.com1.z0.glb.clouddn.com/mx347DC.png)

`工程使用Maven+SpringMVC的方式构建`

`pom.xml`

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.gege</groupId>
	<artifactId>provider</artifactId>
	<packaging>jar</packaging>
	<version>0.0.1-SNAPSHOT</version>

	<properties>
		<spring.version>3.2.8.RELEASE</spring.version>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
	</properties>

	<dependencies>
		<!-- 添加dubbo依赖 -->
		<dependency>
			<groupId>com.alibaba</groupId>
			<artifactId>dubbo</artifactId>
			<version>2.5.3</version>
			<exclusions>
				<exclusion>
					<groupId>org.springframework</groupId>
					<artifactId>spring</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<!-- 添加zk客户端依赖 -->
		<dependency>
			<groupId>com.github.sgroschupf</groupId>
			<artifactId>zkclient</artifactId>
			<version>0.1</version>
		</dependency>
		<!-- spring相关 -->
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-core</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-beans</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-jdbc</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-web</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-webmvc</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-aop</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-tx</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-orm</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context-support</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-test</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-jms</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>jstl</artifactId>
			<version>1.2</version>
		</dependency>
		<dependency>
			<groupId>com.gege</groupId>
			<artifactId>api</artifactId>
			<version>0.0.1-SNAPSHOT</version>
		</dependency>
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>servlet-api</artifactId>
			<version>2.5</version>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>log4j</groupId>
			<artifactId>log4j</artifactId>
			<version>1.2.14</version>
		</dependency>

		<dependency>
			<groupId>cglib</groupId>
			<artifactId>cglib</artifactId>
			<version>2.2</version>
		</dependency>
		<dependency>
			<groupId>commons-lang</groupId>
			<artifactId>commons-lang</artifactId>
			<version>2.5</version>
		</dependency>
		<dependency>
			<groupId>taglibs</groupId>
			<artifactId>standard</artifactId>
			<version>1.1.2</version>
		</dependency>
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-log4j12</artifactId>
			<version>1.7.2</version>
		</dependency>
	</dependencies>
	<build>
		<resources>
			<resource>
              //静态资源文件扫描地址
				<directory>${project.basedir}/src/main/resources</directory>
				<includes>
					<include>*.*</include>
				</includes>
				<filtering>true</filtering>
			</resource>
		</resources>
	</build>
	<profiles>
		<profile>
			<id>local</id>
			<properties>
              //这是zookeeper的地址，要根据实际情况进行配置，默认zookeeper://127.0.0.1:2181
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
              //dubbo暴露的端口配置
				<dubbo.gege.port>29014</dubbo.gege.port>
              //工程的服务集合，${user.name}表示当前PC的UserName
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
              //dubbo服务版本号
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
		</profile>
		<profile>
			<id>dev</id>
			<properties>
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
				<dubbo.gege.port>29014</dubbo.gege.port>
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
		</profile>
		<profile>
			<id>test</id>
			<properties>
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
				<dubbo.gege.port>29014</dubbo.gege.port>
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
		</profile>
		<profile>
			<id>product</id>
			<properties>
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
				<dubbo.gege.port>29014</dubbo.gege.port>
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
		</profile>
	</profiles>

</project>

```

`TestServiceImpl.java`

```java
package com.gege.service.impl;

import org.springframework.stereotype.Service;

import com.gege.service.ITestService;

@Service
public class TestServiceImpl implements ITestService {
	public String getName() {
		return "gege";
	}
}

```

`applicationContext.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:aop="http://www.springframework.org/schema/aop" 
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context 
        http://www.springframework.org/schema/context/spring-context-3.0.xsd
        http://www.springframework.org/schema/tx
  		http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
  		http://www.springframework.org/schema/aop 
  		http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
  		http://www.springframework.org/schema/task  
		http://www.springframework.org/schema/task/spring-task-3.0.xsd">
   
    <task:annotation-driven />
		//注解扫描
		<context:component-scan base-package="com.gege"/> 
	<context:annotation-config />
	
	<bean class="org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor" />
	<bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath*:statics.properties</value>
			</list>
		</property>
	</bean>
	

    <import resource="dubbo-provider.xml"/> 
</beans>

```

`dubbo-provider.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dubbo="http://code.alibabatech.com/schema/dubbo"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://code.alibabatech.com/schema/dubbo
        http://code.alibabatech.com/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<dubbo:application name="provider" />
	<dubbo:registry protocol="dubbo" address="${dubbo.gege.address}" port="${dubbo.gege.port}" />
	<dubbo:protocol name="dubbo" port="${dubbo.gege.port}" />
	<dubbo:monitor protocol="registry" />

	<dubbo:service ref="testServiceImpl" interface="com.gege.service.ITestService" group="${dubbo.gege.group}" version="${dubbo.gege.version}"/> 
</beans>

```

`log4j.properties`

```xml
log4j.rootLogger=debug, stdout, R

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout

#Pattern to output the caller's file name and line number.
log4j.appender.stdout.layout.ConversionPattern=[%d] %t (%F:%L) %-5p - %m%n

log4j.appender.R.Encoding=UTF-8
log4j.appender.R=org.apache.log4j.DailyRollingFileAppender
log4j.appender.R.DatePattern='_'yyyy-MM-dd_HH'.log'
log4j.appender.R.File=${catalina.home}/logs/1.0_order_provider
log4j.appender.R.ImmediateFlush=true
log4j.appender.R.MaxFileSize=10000KB
# Keep one backup file
log4j.appender.R.MaxBackupIndex=20

log4j.appender.R.layout=org.apache.log4j.PatternLayout
log4j.appender.R.layout.ConversionPattern=[%d] %t %c (%F:%L) %-5p - %m%n

log4j.category.com.cheguo=info
log4j.category.org.springframework=info
log4j.category.freemarker=info
```

`statics.properties`

```xml
dubbo.gege.address=${dubbo.gege.address}
dubbo.gege.port=${dubbo.gege.port}
dubbo.gege.version=${dubbo.gege.version}
dubbo.gege.group=${dubbo.gege.group}
dubbo.gege.check=false
dubbo.gege.retries=0
dubbo.gege.timeout=10000
```

`web.xml`

```xml
<!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" >

<web-app>
	<display-name>provider</display-name>
	<servlet>
		<servlet-name>dubboService</servlet-name>
		<servlet-class>com.gege.tool.DubboInit</servlet-class>
		<load-on-startup>1</load-on-startup>
	</servlet>
</web-app>

```

**5、Dubbo服务消费者工程创建与配置**

![Dubbo消费者](http://7xp64w.com1.z0.glb.clouddn.com/mx3D339.png)

`pom.xml`

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.gege</groupId>
	<artifactId>consumer</artifactId>
	<packaging>jar</packaging>
	<version>0.0.1-SNAPSHOT</version>

	<properties>
		<spring.version>3.2.8.RELEASE</spring.version>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
	</properties>

	<dependencies>
		<dependency>
			<groupId>com.alibaba</groupId>
			<artifactId>dubbo</artifactId>
			<version>2.5.3</version>
			<exclusions>
				<exclusion>
					<groupId>org.springframework</groupId>
					<artifactId>spring</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>com.github.sgroschupf</groupId>
			<artifactId>zkclient</artifactId>
			<version>0.1</version>
		</dependency>
		<!-- spring相关 -->
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-core</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-beans</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-jdbc</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-web</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-webmvc</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-aop</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-tx</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-orm</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-context-support</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-test</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-jms</artifactId>
			<version>${spring.version}</version>
		</dependency>
		<dependency>
			<groupId>com.gege</groupId>
			<artifactId>provider</artifactId>
			<version>0.0.1-SNAPSHOT</version>
		</dependency>
		<dependency>
			<groupId>com.gege</groupId>
			<artifactId>api</artifactId>
			<version>0.0.1-SNAPSHOT</version>
		</dependency>
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>servlet-api</artifactId>
			<version>2.5</version>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>log4j</groupId>
			<artifactId>log4j</artifactId>
			<version>1.2.14</version>
		</dependency>

		<dependency>
			<groupId>cglib</groupId>
			<artifactId>cglib</artifactId>
			<version>2.2</version>
		</dependency>
		<dependency>
			<groupId>commons-lang</groupId>
			<artifactId>commons-lang</artifactId>
			<version>2.5</version>
		</dependency>
		<dependency>
			<groupId>taglibs</groupId>
			<artifactId>standard</artifactId>
			<version>1.1.2</version>
		</dependency>
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-log4j12</artifactId>
			<version>1.7.2</version>
		</dependency>
	</dependencies>
	<build>
		<resources>
			<resource>
				<directory>${project.basedir}/src/main/resources</directory>
				<includes>
					<include>*.*</include>
				</includes>
				<filtering>true</filtering>
			</resource>
		</resources>
	</build>
	<profiles>
		<profile>
			<id>local</id>
			<properties>
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
		</profile>
		<profile>
			<id>dev</id>
			<properties>
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
		</profile>
		<profile>
			<id>test</id>
			<properties>
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
		</profile>
		<profile>
			<id>product</id>
			<properties>
				<dubbo.gege.address>zookeeper://127.0.0.1:2181</dubbo.gege.address>
				<dubbo.gege.group>${user.name}</dubbo.gege.group>
				<dubbo.gege.version>1.0.0</dubbo.gege.version>
			</properties>
		</profile>
	</profiles>

</project>

```

`applicationContext.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:aop="http://www.springframework.org/schema/aop" 
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context 
        http://www.springframework.org/schema/context/spring-context-3.0.xsd
        http://www.springframework.org/schema/tx
  		http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
  		http://www.springframework.org/schema/aop 
  		http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
  		http://www.springframework.org/schema/task  
		http://www.springframework.org/schema/task/spring-task-3.0.xsd">
		
	
    <task:annotation-driven />
		<context:component-scan base-package="com.gege"/> 
	<context:annotation-config />
    
	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list> 
				<value>classpath*:statics.properties</value>
			</list>
		</property>
	</bean> 
	
	<import resource="dubbo-customer.xml"/>
</beans> 
```

`dubbo-customer.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dubbo="http://code.alibabatech.com/schema/dubbo"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://code.alibabatech.com/schema/dubbo
        http://code.alibabatech.com/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<dubbo:application name="consumer"></dubbo:application>
	<!-- 使用zookeeper注册中心暴露服务地址  -->
	<dubbo:registry id="gege_center" protocol="dubbo" address="${dubbo.gege.address}" />
	<dubbo:provider group="${dubbo.gege.group}" version="${dubbo.gege.version}" registry="gege_center"/>
	<dubbo:consumer group="${dubbo.gege.group}" version="${dubbo.gege.version}" registry="gege_center" check="false" />
	
	<!-- 声明需要引用的服务接口  -->
	<dubbo:reference id="testService" interface="com.gege.service.ITestService" retries="${dubbo.gege.retries}" timeout="${dubbo.gege.timeout}"/>
</beans>

```

`log4j.properties`

**同上**

`statics.properties`

```xml
dubbo.gege.address=${dubbo.gege.address}
dubbo.gege.group=${dubbo.gege.group}
dubbo.gege.version=${dubbo.gege.version}
dubbo.gege.retries=0
dubbo.gege.timeout=10000
```

`ConsumerServiceTest.java`

```java
package com.gege.service;

import java.io.IOException;

import org.apache.log4j.Logger;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class ConsumerServiceTest {
	Logger logger=Logger.getLogger(ConsumerServiceTest.class);
	public static void main(String[] args) {
        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(
                new String[] { "applicationContext.xml" });
        context.start();
        ITestService testService = (ITestService) context.getBean("testService");
        System.out.println(testService.getName());
        try {
            System.in.read();
        } catch (IOException e) {
            e.printStackTrace();
        }  
 
    }
}

```

**6、运行测试**

1. 运行zookeeper，双击zkServer.cmd

2. 运行dubbo-admin，双击Tomcat7w.exe，点击start

3. 在eclipse中用tomcat运行服务提供者，可能存在超时，配置tomcat的timeout配置就可以了

4. 在eclipse中用tomcat运行服务消费者

5. 消费者工程的ConsumerServiceTest下，右键

   ![](http://7xp64w.com1.z0.glb.clouddn.com/mx3F338.png)

就可以查看是否成功

正常结果：

`gege`



**更多内容可以关注微信公众号，或者访问[AppZone](http://zoeminghong.github.io/)网站**

![http://7xp64w.com1.z0.glb.clouddn.com/qrcode_for_gh_3e33976a25c9_258.jpg](http://7xp64w.com1.z0.glb.clouddn.com/qrcode_for_gh_3e33976a25c9_258.jpg)


- 以上です(Ending)
- ありがどう(Thank You)

---
title: wagon插件使用
tags: code
date: 2017-06-20
---

wagon是maven插件中的一种，其作用是去除我们部署时繁复的步骤，不用再手动上传jar包或者war包到指定服务器路径下面。

<!-- more -->

------
### 问题

有什么用？

怎么用？

有什么优势？

### 使用

`pom.xml`

```xml
    <build>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>wagon-maven-plugin</artifactId>
                <version>1.0</version>
                <configuration>
                  <!--这里的id与之后的setting.xml配置项中的要一致 -->
                    <serverId>demo-test</serverId>
                  <!--本地包路径 -->
                    <fromDir>target/</fromDir>
                  <!--上传哪些包 -->
                    <includes>${project.artifactId}.jar</includes>
                  <!--包保存到服务器哪个路径下面，注意是scp，要支持这个命令才行 -->
                    <url>scp://172.168.1.11:22/opt/micservice</url>
                  <!--服务器目标路径，与url配合使用 -->
                    <toDir>apps/${project.artifactId}</toDir>
                  <!--因为存在服务器的重启之类的操作，wagon也支持使用shell命令，可以有多个command标签哦，根据先后顺序执行-->
                    <commands>
                        <command>cd /opt/micservice/ ; ./dev restart ${project.artifactId} test</command>
                    </commands>
                  <!-- 显示运行命令的输出结果 -->
					<displayCommandOutputs>true</displayCommandOutputs>
                </configuration>
            </plugin>
        </plugins>
        <extensions>
            <extension>
                <groupId>org.apache.maven.wagon</groupId>
                <artifactId>wagon-ssh</artifactId>
                <version>2.8</version>
            </extension>
        </extensions>
    </build>
```

`setting.xml`

```xml
<servers>
    <server>
        与上面的serverId一致
        <id>demo-test</id>
        <username>username</username>
        <password>password</password>
    </server>
</servers>
```

配置完成后，运行命令：

```Shell
mvn clean package wagon:upload wagon:sshexec
```

wagon:upload-single是上传jar或者war包

wagon:sshexec是执行配置中的shell命令

如果不想执行上面的这么长串命令，也可以使用execution

```xml
<build>
	<extensions>
		<extension>
			<groupId>org.apache.maven.wagon</groupId>
			<artifactId>wagon-ssh</artifactId>
			<version>2.8</version>
		</extension>
	</extensions>
	<plugins>
		<plugin>
			<groupId>org.codehaus.mojo</groupId>
			<artifactId>wagon-maven-plugin</artifactId>
			<version>1.0</version>
			<executions>
				<execution>
					<id>upload-deploy</id>
					<!-- 运行package打包的同时运行upload-single和sshexec-->
					<phase>package</phase>
					<goals>
						<goal>upload-single</goal>
						<goal>sshexec</goal>
					</goals>
					<configuration>
						<serverId>mylinuxserver</serverId>
						<fromFile>target/javawebdeploy.war</fromFile>
						<url>scp://192.168.20.128/coder/tomcat/apache-tomcat-7.0.55/webapps</url>
						<commands>
							<command>sh /coder/tomcat/apache-tomcat-7.0.55/bin/shutdown.sh</command>
							<command>rm -rf /coder/tomcat/apache-tomcat-7.0.55/webapps/javawebdeploy</command>
							<command>sh /coder/tomcat/apache-tomcat-7.0.55/bin/startup.sh</command>
						</commands>
						<displayCommandOutputs>true</displayCommandOutputs>
					</configuration>
				</execution>
			</executions>
		</plugin>
	</plugins>
</build>
```

以上`mvn clean package` 来代替 `mvn clean package wagon:upload-single wagon:sshexec`，但个人觉得不是特别适合开发时期，我觉得还是使用命令的方式执行，或者通过自己写一个shell文件，需要的时候执行一下即可。

### Tips

关于一些goals

> - [wagon:upload-single](http://www.mojohaus.org/wagon-maven-plugin/upload-single-mojo.html) uploads the specified file to a remote location.
> - [wagon:upload](http://www.mojohaus.org/wagon-maven-plugin/upload-mojo.html) uploads the specified set of files to a remote location.
> - [wagon:download-single](http://www.mojohaus.org/wagon-maven-plugin/download-single-mojo.html) downloads the specified file from a remote location.
> - [wagon:download](http://www.mojohaus.org/wagon-maven-plugin/download-mojo.html) downloads the specified set of files from a remote location.
> - [wagon:list](http://www.mojohaus.org/wagon-maven-plugin/list-mojo.html) lists the content of a specified location in a remote repository.
> - [wagon:copy](http://www.mojohaus.org/wagon-maven-plugin/copy-mojo.html) copies a set of files under a Wagon repository to another.
> - [wagon:merge-maven-repos](http://www.mojohaus.org/wagon-maven-plugin/merge-maven-repos-mojo.html) merges , including metadata, a Maven repository to another.
> - [wagon:sshexec](http://www.mojohaus.org/wagon-maven-plugin/sshexec-mojo.html) Executes a set of commands at remote SSH host.

其他的标签

skip属性，boolean类型，默认是true，作用是忽略execution

### 优势

- 去除了发布的重复动作，直接一个命令就可以完成
- 将人为的错误降低了，工作更加高效

链接

[官方文档](http://www.mojohaus.org/wagon-maven-plugin/plugin-info.html)

